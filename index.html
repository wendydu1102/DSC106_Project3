<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CMIP6 Coverage Explorer — Interactive D3 Visualization</title>
  <meta name="description" content="Explore CMIP6 model coverage across experiments and variables (tas, pr, etc.) using interactive D3 charts." />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <header>
    <h1>Project 3 - CMIP6 Coverage Explorer</h1>
    <p class="subtitle">Interactive exploration of CMIP6 (Coupled Model Intercomparison Project Phase 6) zarr-store coverage across models, experiments, and variables.</p>
  </header>

  <section id="controls" class="card">
    <h2>Filters</h2>
    <div class="filters">
      <div>
        <h3>Experiments</h3>
        <div id="experiment-filters" class="checkboxes"></div>
      </div>
      <div>
        <h3>Variables</h3>
        <div id="variable-filters" class="checkboxes"></div>
      </div>
      <div>
        <h3>Search Model</h3>
        <input type="text" id="model-search" placeholder="Type to filter by model (source_id)..." />
      </div>
      <div>
        <button id="reset-btn">Reset Filters</button>
      </div>
    </div>
  </section>

  <main class="grid">
    <section class="card">
      <h2>By Variable (Treemap)</h2>
      <svg id="treemap" width="600" height="420" role="img" aria-label="Treemap of variable coverage"></svg>
      <p class="caption">Size encodes number of zarr stores for each variable within the current filter.</p>
    </section>

    <section class="card">
      <h2>Models × Experiments (Heatmap)</h2>
      <svg id="heatmap" width="700" height="520" role="img" aria-label="Heatmap of models by experiments"></svg>
      <p class="caption">Color encodes count of available variables for each (model, experiment) combination.</p>
    </section>

    <section class="card">
      <h2>Publication Year (Histogram + Brush)</h2>
      <svg id="year-hist" width="700" height="300" role="img" aria-label="Histogram of publication year"></svg>
      <p class="caption">Brush to filter by publication year derived from the dataset version field.</p>
    </section>

    <section class="card" id="details">
      <h2>Matching Records</h2>
      <div id="records"></div>
      <p class="caption">Click any heatmap cell to see the first 50 matching records.</p>
    </section>
  </main>

  <section id="writeup" class="card">
    <h2>Write-up</h2>
    <h3>Motivation & Question</h3>
    <p>
      Earth system model data in CMIP6 is vast and heterogeneous. Researchers often need to know which
      variables are available for which experiments and models <em>before</em> deciding what to download and analyze.
      Our question: <strong>Which models provide coverage for key climate variables (e.g., near-surface air temperature <code>tas</code>, precipitation <code>pr</code>) across future scenarios (SSPs) and historical runs?</strong>
    </p>

    <h3>Data</h3>
    <p>
      We use a public catalog of CMIP6 Zarr stores (subsetted for size on this page) containing fields such as
      <code>source_id</code> (model), <code>experiment_id</code>, <code>variable_id</code>, and the cloud <code>zstore</code> path.
      The subset includes variables {tas, tasmax, tasmin, pr, psl, tos, siconc, sos} and experiments {historical, ssp126, ssp245, ssp370, ssp585}.
      Each row corresponds to a distinct Zarr store. See the repository <code>data/</code> folder for exact CSVs used by this page.
    </p>

    <h3>Visual Encodings</h3>
    <ul>
      <li><strong>Treemap</strong> — a rectangle area for each variable sized by the number of stores (position and area for comparison).</li>
      <li><strong>Heatmap</strong> — rows: models, columns: experiments, color: number of variables matching current filters.</li>
      <li><strong>Histogram</strong> — bars by publication <em>year</em> (from the <code>version</code> field), enabling a brush-based time filter.</li>
    </ul>

    <h3>Interactions</h3>
    <ul>
      <li>Dynamic query filters for experiments and variables.</li>
      <li>Text search for models (<code>source_id</code>).</li>
      <li>Treemap click to focus on a variable.</li>
      <li>Heatmap click to reveal a details table of matching records.</li>
      <li>Brush on the year histogram to restrict the time window.</li>
    </ul>

    <h3>Data Transformations</h3>
    <p>
      We filter to the selected experiments/variables and (optional) year brush range and model search term.
      We then aggregate counts per variable (treemap) and per (model, experiment) pair (heatmap). These transformations are standard and
      do not remove informative outliers; instead they summarize availability to aid discovery.
    </p>

    <h3>Development Process</h3>
    <p>
      Our team consided of Shunyi Du (s7du@ucsd.edu), Vanshika Somani (vsomani@ucsd.edu), Amjad Muhamad Afandy (amuhamadafandy@ucsd.edu), Sunny Sun (chs019@ucsd.edu) 
      and we spent ~25 hours on this project. One member handled the data wrangling and page scaffolding,
      one built the treemap, one built the heatmap and histogram, and one integrated interactions and polished up final product.
      Most time was spent on interaction polish like brush communications and reset logic and debugging layout.
    </p>

    <h3>Rationale for Choices</h3>
    <p>
      We chose a treemap to quickly compare variable coverage magnitudes, and a heatmap to reveal which models
      support which experiments at a glance. A year histogram with brushing lets us focus on well‑populated vintages
      (e.g., 2019–2021) and verify recency. Alternative designs we considered included a faceted bar chart and a bipartite
      node‑link diagram, but they either consumed more space or provided less dense comparisons.
    </p>
  </section>

  <footer>
    <p>Built with D3.js. Data © CMIP6 providers. This is a student project for DSC106 at UCSD.</p>
  </footer>

  <script src="script.js"></script>
</body>
</html>
